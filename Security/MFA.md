<h3>Manage MFA Time-Based One-Time Password (TOTP) on IBM i V7R6</h3>

<h4>Enabling MFA on your system</h4>
<ul>
  <li>System value QSECURITY security level must be >= 40</li>
  <li>System value QPWDLVL password level must be >= 4</li>
  <li>DSPSECA - Display Security Attributes</li>
  <li>CHGSECA - Change  Security Attributes <br />Set Additional sign-on factor (ADLSGNFAC) parameter : <br /><code>CHGSECA   ADLSGNFAC(*ENABLED)</code><br />A change to this value takes effect at the next IPL.</li>
  <li>CHGNTPA - Change SNTP Attributes<code>
    CHGNTPA RMTSYS(time server ip) AUTOSTART(*YES)
    STRTCPSVR SERVER(*NTP)
  </code></li>
  <li>SignOn screen - <br />If you have a customized sign-on screen, you must create a new one based on QDSIGNON3 before you IPL.<br />SignOn display file member (QDSIGNON, QDSIGNON2, or QDSIGNON3) in the QSYS/QAWTSSRC physical file.</li>
</ul>
<h4>Enabling MFA for a user</h4>
<ol>
  <li>Administrator action:<br />CHGUSRPRF  - Change User Profile Authentication Methods (AUTHMTH) parameter : <br /><code>CHGUSRPRF AUTHMTH(*TOTP)</code></li>
  <li>User action:<br />CHGTOTPKEY - Change TOTP Key<br /><code>
      CHGTOTPKEY   TOTPKEY(*GEN)
      CHGTOTPKEY   TOTPKEY(TOTP key value)
    </code><br />The value must be 32-characters that contain valid base 32 characters only (A - Z and 2 - 7).<br />This command will generate a TOTP key for the currently running user and store the TOTP key in their profile.
  <li>Enter the TOTP key into a client authenticator application</li>
  <li>CHKTOTP - Check that the TOTP value generated by the client authenticator application<br /><code>
    CHKTOTP PASSWORD(user password) TOTP(totp value)
  </code></li>  
</ol>

<h4>Reference</h4>
<ul>
  <li>Multi-factor authentication (MFA) <a href="https://www.ibm.com/docs/en/ssw_ibm_i_76/pdf/mfapdf.pdf">PDF</a><br />https://www.ibm.com/docs/en/i/7.6.0?topic=security-multi-factor-authentication-mfa</li>
  <li>Using IBM Navigator for i to Manage MFA<br />https://www.ibm.com/support/pages/node/7180390</li>
</ul>
<h4>API</h4>
<ul>
  <li>Retrieve TOTP Key (QSYRTVK) returns to the caller a protected version of the time-based one-time password (TOTP) key for the specified user profile.<br />https://www.ibm.com/docs/api/v1/content/ssw_ibm_i_76/apis/qsyrtvk.htm</li>
  <li>Set TOTP Key (QSYSETK) sets the time-based one-time password (TOTP) key for the specified user profile by using the receiver variable that was retrieved with the Retrieve TOTP Key (QSYRTVK) API<br />https://www.ibm.com/docs/api/v1/content/ssw_ibm_i_76/apis/qsysetk.htm</li>
</ul>
